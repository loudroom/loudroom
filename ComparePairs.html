<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Price Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            width: 300px;
            margin: auto;
        }
        select, input, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
        }
        #result {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Token Price Calculator</h2>
        <label for="token1">Token 1:</label>
        <select id="token1">
            <option value="0xae13d989dac2f0debff460ac112a837c89baa7cd">BNB</option>
            <option value="0xd66c6B4F0be8CE5b39D52E0Fd1344c389929B378">ETH</option>
            <option value="0x6ce8dA28E2f864420840cF74474eFf5fD80E65B8">BTC</option>
            <option value="0x337610d27c682E347C9cD60BD4b3b107C9d34dDd">USDT</option>
        </select>

        <label for="token2">Token 2:</label>
        <select id="token2">
            <option value="0xae13d989dac2f0debff460ac112a837c89baa7cd">BNB</option>
            <option value="0xd66c6B4F0be8CE5b39D52E0Fd1344c389929B378">ETH</option>
            <option value="0x6ce8dA28E2f864420840cF74474eFf5fD80E65B8">BTC</option>
            <option value="0x337610d27c682E347C9cD60BD4b3b107C9d34dDd">USDT</option>
        </select>

        <label for="amountIn">Amount In:</label>
        <input type="number" id="amountIn" placeholder="Enter amount" />

        <button onclick="fetchTokenData()">Get Token Data</button>

        <div id="result">
            <p>Amount Out: <span id="amountOut">0</span></p>
            <p>USDT Value: <span id="usdtValue">0</span></p>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.3/dist/web3.min.js"></script>
   
    <script>
        let web3;
        let contractInstance;
        let userAddress = [];

        // Contract ABI and address
        const contractABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_router",
				"type": "address"
			}
		],
		"name": "setRouterAddress",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_usdt",
				"type": "address"
			}
		],
		"name": "setUsdtAddress",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_router",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_usdt",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "tokenIn",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "tokenOut",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amountIn",
				"type": "uint256"
			}
		],
		"name": "getEquivalentTokenAmount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "amountOut",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "usdtValue",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "router",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "usdt",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
console.log(`end of abi`);
        const contractAddress = "0x4f8D05285F3CE182169F4607Aa127106a669D981"; // Replace with your contract address

        // Token decimals mapping
        const tokenDecimals = {
            "0xae13d989dac2f0debff460ac112a837c89baa7cd": 18, // BNB
            "0xd66c6B4F0be8CE5b39D52E0Fd1344c389929B378": 18, // ETH
            "0x6ce8dA28E2f864420840cF74474eFf5fD80E65B8": 18, // BTC
            "0x337610d27c682E347C9cD60BD4b3b107C9d34dDd": 6   // USDT
        };
		console.log(`token decimals`);

        async function initWeb3() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                await window.ethereum.request({ method: 'eth_requestAccounts' });

                // Get the user's address
                userAddress = await web3.eth.getAccounts();
                console.log("User address:", userAddress[0]);

                contractInstance = new web3.eth.Contract(contractABI, contractAddress);
                console.log(contractInstance);
            } else {
                alert("Please install MetaMask!");
            }
        }

        async function fetchTokenData() {
            try {
                const token1 = document.getElementById('token1').value;
                const token2 = document.getElementById('token2').value;
                const amountIn = document.getElementById('amountIn').value;
				console.log(`token 1 ${token1}   token 2 ${token2}    amountIn ${amountIn}`);
                // Validate token addresses
             //   if (!tokenDecimals[token1] || !tokenDecimals[token2]) {
              //      alert("Invalid token address selected.");
             //      return;
              //  }

                // Convert amountIn to the appropriate decimals
                const amountInWei = BigInt(amountIn) * BigInt(10 ** tokenDecimals[token1]);
				console.log(`amount in wei ${amountInWei} `);
                const result = await contractInstance.methods
                    .getEquivalentTokenAmount(token1, token2, amountInWei)
                    .call({ from: userAddress[0], gas: 10000000 });

				//	console.log(`result ${result} `);	
                const amountOut = result[0] ;// / BigInt(10 ** tokenDecimals[token2]);
                const usdtValue = result[1] ;/// BigInt(10 ** 6); // USDT is always 6 decimals
				console.log(`amountOut ${amountOut} `);	
                document.getElementById('amountOut').textContent = amountOut.toString();
                document.getElementById('usdtValue').textContent = usdtValue.toString();
            } catch (error) {
                console.error("Error fetching data:", error);
                alert("An error occurred while fetching the data. Please try again.");
            }
        }

        // Initialize Web3 and the contract
        initWeb3();
    </script>
</body>
</html>
